# 第五章

> 本章极少创建高性能索引

## 索引基础

* 通过索引确定行，然后获取行数据。
* 多列索引的顺序十分重要，因为MySQL只能高效的使用索引的最左前缀列。

### 索引类型

MySQL中索引是在存储引擎层实现的，不同的存储引擎实现方案不同，所以并没有统一的索引标准。

MySIAM使用前缀压缩技术，使得索引更小，但BINNODB使用原数据格式进行存储。

MySIAM索引通过数据的物理位置引用被索引的行，INNODB则根据主键引用被索引的行。

B-Tree通常意味着所有的值都是按照顺序存储，并且每一个叶子页面到根的距离相同。

B-Tree索引的存储引擎不在进行全表扫描，而是从根节点开始进行搜索，根节点的槽中存放了指向子节点的指针，存储引擎根据这些指针向下层找，通过比较节点页面的值和要查找的值可以找到合适的指针进入下层子节点，这些指针实际上定义了子节点页中的值的上下限，最终存储引擎要么找到符合条件的叶子节点，最终的叶子指向被索引的数据，没找到叶子节点该记录不存在。

B-Tree对索引是顺序组织存储的，所以很合适查找范围数据。

组合索引，如果不是按照索引最左列开始查找，则无法使用索引。

组合索引中不可以跳过列索引，就是条件中使用第一列索引后不可以直接使用第三列索引，这样情况下只有第一列索引生效。

组合索引的如果其中某一列有范围查询，则该列右边也就是后面的索引列都将无效。

Hash索引：基于Hash表实现的，对于每一行索引都会建立一个Hash值，每个Hash值对应的保存了指向数据行的指针。

Hash碰撞：Hash表计算的值出现重复。一个Hash值指向多个列，则就要对碰撞的列循环进行后面的条件筛选

| 槽(Slot) | 值(Value)       |
| -------- | --------------- |
| 2323     | 指向第1行的指针 |
| 2324     | 指向第2行的指针 |
| 2325     | 指向第3行的指针 |

每个槽都是顺序的，但是数据行不是。

Hash索引结构十分紧凑，也是顺序，所以定位非常快，查询非常快速。

Hash缺点：

​	索引中存储的是索引Hash值和指向数据的指针，并没有数据中任何值，所以不可以从所以中获取任何数据，只能定位到位置后从磁盘中获取需要的值。

​	Hash索引并不是按照索引的值进行排序而是按照值的Hash值排序存储的。所以也就无法用于排序。

​	组合索引的Hash值不能按照其中一列进行索引，因为Hash值是根据整个整个索引的值生成的。

​	Hash只支持等值比较查询，包括 = 、IN()、<=>。不支持<、>等范围查询。

INNODB引擎注意到某些索引被使用的非常频繁，它会自动、自主的在内存中基于B-Tree上再建立一个Hash索引，这是INNODB的“自适应哈希索引”。

全文索引对比值中的关键词。


## 索引的优点

1. 大大减少服务器需要扫描的数据量
2. 帮助服务器避免排序和临时表建立
3. 将随机I/O变成顺序I/O

## 高新能的索引策略

* 独立的列

  指不能是表达式的一部分，也不能是函数的参数。

* 前缀索引

  对于比较长的字符串索引选择合适长度的前缀索引

* 选择合适顺序的组合索引

  选择性最高的列放在前面通常最佳。

### 聚簇索引

一种索引的存储方式，将数据实际存放在索引的叶子页中。

## 维护索引和表

