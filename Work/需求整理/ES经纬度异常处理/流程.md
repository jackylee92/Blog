[TOC]

>author：李俊东
>
>startDate：0000-00-00
>
>endDate：0000-00-00

## 功能介绍

> 订单中location字段，会出现格式错误，非正规经纬度，导致整条DOC无法插入

## 实现方案

> 添加location_2字段使用``ignore_malformed`` 废弃原location字段，将原location字段对外名称映射到location_2上
>
> job(定时任务)、server(基础服务)、api(接口)、async(异步)、lock(锁) 使用到的功能提供的功能、实现方案

1. 在es结构库中添加该字段的配置

   ````
   INSERT INTO `elasticsync`.`struct`( `i_id`, `status`, `field`, `alias`, `type`, `index`, `analyzer`, `r_id`, `create_time`, `remark`, `level`) VALUES (11, 0, 'location_2', 'location2', 'geo_point', 1, '', 78, '2020-04-30 15:07:20', '经纬度', 1);
   ````

2. 发布新的同步服务，因为location中使用的是组建获取数据方式，所以，location_2也同样可以使用，需要在组件的数组中添加返回localtion_2的键

3. 根据数据库中配置在elasticsearch中创建该索引的未创建的字段

   ````
   curl --request POST --url 地址 --header 'Content-Type: application/json'  --data '{"Type" : "createField","Data" : {"Index" : "order","Version" : "1.0.6"}}'
   ````

4. 查看字段是否创建，``ignore_malformed``是否正确；

5. 查看后面该字段是否同步进去；

6. location字段目前无接口使用，暂停原``location``字段

   ````
   UPDATE `struct` SET `status`=2 WHERE `s_id`=729;
   ````

7. 将新字段``location_2``对外别名改为``location``

   ````
   UPDATE `struct` SET `alias`="location" WHERE `field`="location_2";
   ````

8. 启动全量数据同步；

### 补充



## 主要函数

> 涉及到的函数封装



## 注意事项

> 开发中的注意事项