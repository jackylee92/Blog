## 大数据、高并发

> 大数据高并发一般对于商城，活动的项目中出现比较多，正常的企业站出现高并发比较少；对于高并发从软件方面考虑我主要从资源、数据、web服务、和集群方面入手；

__从外到内部，一层层剥，主要注意一下：__

* 资源：考虑准备一台或者多台cnd服务器，将静态资源独立开；将静态资源的请求压力分布到其他服务器上；例如：图片，css文件，js文件、swp文件等；静态资源也可以考虑使用分布式存储；
代码：优化代码执行效率、占用内容；从细节考虑：

  * 1、字符串使用单引号；双引号PHP会去检索双引号里面的变量；影响执行效率；
  * 2、使用foreach 代替for 效率更高；不要把count()、strlen()等每次结果都一样的代码写在循环中；可以放在循环外面；例如 For($x=0; $x < count($array); $x), count() 函数在外面先计算 ;
  * 3、及时注销那些不用的变量、尤其大数组、对象之类；及时释放内存；
  * 4、能够使用函数代替正则就用函数；
  * 5、尽量少用str_replace;确保需要用str_replace时才用str_replace;因为如果用了str_replace,但没有需要替换的字符串，系统也会分配内存；解决方案：先strpos查找有没有需要替换的字符串；有则使用str_replace;产生的结果：一：如果需要替换，多执行了一个strpos然后str_replace;这样效率影响不会太大；strpos 执行效率比较高的；二：没有需要替换的字符串，只是执行了一个strpos;没有执行str_replace;效率提升很多；
  * 6、使用switch好过使用多个if else;
  * 7、如果使用apache；打开mod_deflate模块，可以提高网页速度；mod_deflate 允许服务器将内容发送到客户端前进行压缩；减少带宽；
  * 8、函数中递增局部变量速度比递增全局变量快两倍；能使用局部变量尽量不要使用全局变量或者对象变量；
  * 9、循环内部尽量不要做声明变量、对象、大变量；可以在循环前预定义这些变量；

* 缓存：根据场景将数据存入缓存redis;合理利用redis 的五种数据结构；对于商品的评论、详情、统计等数据都可以存入缓存中；

* server：使用nginx+php-fpm；nginx并发比apache高十倍左右；
mysql：查询方面尽量不要使用*查询，避免子查询，正确使用索引技术；对数据库减少压力使用主从分离；读写分离；使用多个mysql服务器来分布数据库请求压力；
* 服务器负载均衡：架一台负载均衡服务器；将请求分摊到多个集群服务器上；nginx负载均衡四种策略：轮循（默认）、指定权重、ip_hash、fair；